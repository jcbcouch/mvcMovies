@model MvcMovies.Models.Movie

@{
    ViewData["Title"] = Model?.Title ?? "Movie Details";
}

@if (Model != null)
{
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-4">
                @if (!string.IsNullOrEmpty(Model.Poster) && Model.Poster != "N/A")
                {
                    <img src="@Model.Poster" alt="@Model.Title Poster" class="img-fluid rounded shadow">
                }
                else
                {
                    <div class="bg-light p-5 text-center">
                        <p>No poster available</p>
                    </div>
                }
            </div>
            <div class="col-md-8">
                <h1>@Model.Title <small class="text-muted">(@Model.Year)</small></h1>
                
                <div class="mb-3">
                    @if (!string.IsNullOrEmpty(Model.ImdbRating) && Model.ImdbRating != "N/A")
                    {
                        <span class="badge bg-warning text-dark">IMDb @Model.ImdbRating/10</span>
                    }
                    @if (!string.IsNullOrEmpty(Model.Rated) && Model.Rated != "N/A")
                    {
                        <span class="badge bg-secondary">@Model.Rated</span>
                    }
                    @if (!string.IsNullOrEmpty(Model.Runtime) && Model.Runtime != "N/A")
                    {
                        <span class="text-muted">@Model.Runtime</span>
                    }
                </div>
                
                @if (!string.IsNullOrEmpty(Model.Plot) && Model.Plot != "N/A")
                {
                    <div class="mb-3">
                        <h4>Plot</h4>
                        <p>@Model.Plot</p>
                    </div>
                }
                
                <dl class="row">
                    @if (!string.IsNullOrEmpty(Model.Director) && Model.Director != "N/A")
                    {
                        <dt class="col-sm-3">Director</dt>
                        <dd class="col-sm-9">@Model.Director</dd>
                    }
                    
                    @if (!string.IsNullOrEmpty(Model.Writer) && Model.Writer != "N/A")
                    {
                        <dt class="col-sm-3">Writer</dt>
                        <dd class="col-sm-9">@Model.Writer</dd>
                    }
                    
                    @if (!string.IsNullOrEmpty(Model.Actors) && Model.Actors != "N/A")
                    {
                        <dt class="col-sm-3">Actors</dt>
                        <dd class="col-sm-9">@Model.Actors</dd>
                    }
                    
                    @if (!string.IsNullOrEmpty(Model.Genre) && Model.Genre != "N/A")
                    {
                        <dt class="col-sm-3">Genre</dt>
                        <dd class="col-sm-9">@Model.Genre</dd>
                    }
                    
                    @if (!string.IsNullOrEmpty(Model.Released) && Model.Released != "N/A")
                    {
                        <dt class="col-sm-3">Released</dt>
                        <dd class="col-sm-9">@Model.Released</dd>
                    }
                    
                    @if (!string.IsNullOrEmpty(Model.Language) && Model.Language != "N/A")
                    {
                        <dt class="col-sm-3">Language</dt>
                        <dd class="col-sm-9">@Model.Language</dd>
                    }
                    
                    @if (!string.IsNullOrEmpty(Model.Country) && Model.Country != "N/A")
                    {
                        <dt class="col-sm-3">Country</dt>
                        <dd class="col-sm-9">@Model.Country</dd>
                    }
                </dl>
                
                <div class="mt-4">
                    <a href="https://www.imdb.com/title/@Model.ImdbID" target="_blank" class="btn btn-primary">
                        View on IMDb
                    </a>
                    <a asp-action="Search" class="btn btn-outline-secondary">Back to Search</a>
                </div>

                @if (User?.Identity?.IsAuthenticated == true)
                {
                    var lists = ViewBag.UserMovieLists as IEnumerable<MvcMovies.Models.MovieList>;
                    if (lists != null && lists.Any())
                    {
                        <form asp-controller="MovieLists" asp-action="AddItem" method="post" class="mt-3">
                            <input type="hidden" name="imdbId" value="@Model.ImdbID" />
                            <div class="row g-2 align-items-center">
                                <div class="col-auto">
                                    <label for="movieListId" class="col-form-label">Add to list:</label>
                                </div>
                                <div class="col-auto">
                                    <select id="movieListId" name="movieListId" class="form-select" required>
                                        <option value="">Select a list...</option>
                                        @foreach (var l in lists)
                                        {
                                            <option value="@l.Id">@l.Title</option>
                                        }
                                    </select>
                                </div>
                                <div class="col-auto">
                                    <button type="submit" class="btn btn-success">Add</button>
                                </div>
                            </div>
                        </form>
                    }
                    else
                    {
                        <div class="alert alert-info mt-3">
                            You don't have any movie lists yet. <a asp-controller="MovieLists" asp-action="Create">Create one</a> to start adding movies.
                        </div>
                    }
                }
            </div>
        </div>
    </div>
}
else
{
    <div class="container mt-4">
        <div class="alert alert-warning">Movie not found.</div>
        <a asp-action="Search" class="btn btn-primary">Back to Search</a>
    </div>
}
